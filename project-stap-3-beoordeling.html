<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POM – Beoordelingskader</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body class="min-h-screen bg-gray-50 flex items-center justify-center p-8">

  <div class="flex gap-6 items-start max-w-3xl w-full">

    <!-- Main card -->
    <div class="card flex-1">
      <a href="besluit.html" class="breadcrumb mb-4 inline-block">← Terug naar besluit</a>
      <h2 class="text-xl font-semibold text-gray-800 mb-1 text-center">beoordelingskader</h2>
      <p class="text-xs text-gray-400 text-center mb-6">Verdeel de 27 punten over de 9 dimensies (alle sliders staan standaard op 3).</p>

      <!-- Sliders -->
      <div id="sliders" class="flex flex-col gap-5"></div>

      <!-- Sum indicator -->
      <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-100">
        <div class="text-sm text-gray-500">
          Totaal: <span id="sum-display" class="font-bold text-violet-600">27</span> / 27
          <span id="sum-hint" class="ml-2 text-xs text-gray-400">(alle dimensies op 3)</span>
        </div>
        <button id="opslaan-btn" onclick="slaWegingen()" class="btn-primary px-6 py-2">Opslaan</button>
      </div>
    </div>

    <!-- Info card -->
    <div class="info-card w-56 flex-shrink-0">
      <p class="font-semibold text-violet-700 mb-2">Beoordelingskader</p>
      Verdeel de 27 punten naar uw prioriteiten. Dimensies met meer punten wegen
      zwaarder in het advies. De totaalsom moet precies 27 zijn om op te slaan.
    </div>
  </div>

  <script src="js/state.js"></script>
  <script>
    const project = getCurrentProject();
    if (!project) { window.location.href = 'index.html'; }

    const DIMENSIES = [
      { key: 'betereSchool',                label: 'Betere school',                 info: 'Weging voor algemene onderwijskwaliteit en pedagogische omgeving.' },
      { key: 'functioneleSchool',           label: 'Functionele school',            info: 'Hoe goed ruimtes aansluiten bij de onderwijspraktijk en dagelijkse activiteiten.' },
      { key: 'aantrekkelijkeSchool',        label: 'Aantrekkelijke school',         info: 'Esthetische kwaliteit en architectonische uitstraling van het gebouw.' },
      { key: 'inclusieveSchool',            label: 'Inclusieve school',             info: 'Toegankelijkheid voor iedereen, inclusief leerlingen met een beperking.' },
      { key: 'gezondSchool',                label: 'Gezonde school',                info: 'Binnenluchtkwaliteit, daglicht, thermisch comfort en akoestiek.' },
      { key: 'duurzameSchool',              label: 'Duurzame school',               info: 'Energieprestatie, materiaalgebruik en klimaatbestendigheid van het gebouw.' },
      { key: 'veiligSchool',                label: 'Veilige school',                info: 'Inbraakpreventie, brandveiligheid en sociale veiligheid voor leerlingen en personeel.' },
      { key: 'digitaleSchool',              label: 'Digitale school',               info: 'ICT-infrastructuur en digitale integratie in de leeromgeving.' },
      { key: 'onderhoudsvriendelijkeSchool', label: 'Onderhoudsvriendelijke school', info: 'Laag onderhoud, eenvoudig beheer en lange technische levensduur.' },
    ];

    const initVals = project.sliders || {};

    // Render sliders
    const container = document.getElementById('sliders');
    DIMENSIES.forEach(d => {
      const val = initVals[d.key] ?? 3;
      const row = document.createElement('div');
      row.className = 'flex items-center gap-4';
      row.innerHTML = `
        <label class="text-sm text-gray-600 w-52 text-right flex-shrink-0">${d.label}</label>
        <div class="flex-1 flex items-center gap-3">
          <input type="range" min="1" max="5" value="${val}" id="sl-${d.key}"
                 oninput="onSlider()" class="flex-1"/>
          <span id="val-${d.key}" class="text-sm font-semibold text-violet-600 w-4 text-center">${val}</span>
        </div>
        <span class="info-wrap">
          <button class="info-btn" type="button">i</button>
          <span class="info-popover">${d.info}</span>
        </span>`;
      container.appendChild(row);
    });

    function getValues() {
      return Object.fromEntries(DIMENSIES.map(d => [d.key, parseInt(document.getElementById('sl-' + d.key).value)]));
    }

    function onSlider() {
      const vals = getValues();
      const sum  = Object.values(vals).reduce((a, b) => a + b, 0);
      DIMENSIES.forEach(d => {
        document.getElementById('val-' + d.key).textContent = vals[d.key];
      });
      const display = document.getElementById('sum-display');
      display.textContent = sum;
      display.className = sum === 27 ? 'font-bold text-violet-600' : 'font-bold text-red-500';
      document.getElementById('sum-hint').textContent = sum === 27 ? '✓' : `(${27 - sum > 0 ? 27 - sum + ' over' : Math.abs(27 - sum) + ' te veel'})`;
      document.getElementById('opslaan-btn').disabled = sum !== 27;
    }

    function slaWegingen() {
      updateCurrentProject({ sliders: getValues() });
      window.location.href = 'besluit.html';
    }

    // Info popovers
    document.addEventListener('click', e => {
      const btn = e.target.closest('.info-btn');
      const allPopovers = document.querySelectorAll('.info-popover.open');
      const allBtns = document.querySelectorAll('.info-btn.open');
      if (btn) {
        const popover = btn.nextElementSibling;
        const isOpen = popover.classList.contains('open');
        allPopovers.forEach(p => p.classList.remove('open'));
        allBtns.forEach(b => b.classList.remove('open'));
        if (!isOpen) { popover.classList.add('open'); btn.classList.add('open'); }
      } else if (!e.target.closest('.info-wrap')) {
        allPopovers.forEach(p => p.classList.remove('open'));
        allBtns.forEach(b => b.classList.remove('open'));
      }
    });

    onSlider();
  </script>
  <script src="js/bot.js"></script>
</body>
</html>
